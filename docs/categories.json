{
  "feature": "Category Management System",
  "description": "Sistema hier√°rquico de categorias e subcategorias para organiza√ß√£o do f√≥rum. Suporta at√© 3 n√≠veis de profundidade (Categoria > Subcategoria > Sub-subcategoria > Threads). Master e Admin podem criar, editar, reorganizar e bloquear categorias.",
  "baseUrl": "/api/v1/categories",
  "hierarchy": {
    "description": "Estrutura em √°rvore com at√© 3 n√≠veis",
    "levels": {
      "0": "Categoria Principal (raiz)",
      "1": "Subcategoria",
      "2": "Sub-subcategoria (n√≠vel m√°ximo)"
    },
    "example": "Social > Not√≠cias > Tecnologia > [Threads aqui]"
  },
  "routes": [
    {
      "name": "Obter √Årvore Completa de Categorias",
      "method": "GET",
      "path": "/tree",
      "description": "Retorna toda a estrutura hier√°rquica de categorias em formato de √°rvore",
      "authentication": "Public",
      "response": {
        "success": true,
        "data": {
          "tree": [
            {
              "id": "uuid",
              "name": "Social",
              "slug": "social",
              "description": "string | null",
              "parent_id": null,
              "display_order": 0,
              "is_locked": false,
              "icon": "üë•",
              "level": 0,
              "thread_count": 0,
              "post_count": 0,
              "children": [
                {
                  "id": "uuid",
                  "name": "Not√≠cias",
                  "slug": "noticias",
                  "description": "string | null",
                  "parent_id": "uuid",
                  "display_order": 0,
                  "is_locked": false,
                  "icon": null,
                  "level": 1,
                  "thread_count": 5,
                  "post_count": 23,
                  "children": [
                    {
                      "id": "uuid",
                      "name": "Tecnologia",
                      "slug": "tecnologia",
                      "description": "string | null",
                      "parent_id": "uuid",
                      "display_order": 0,
                      "is_locked": false,
                      "icon": null,
                      "level": 2,
                      "thread_count": 12,
                      "post_count": 45,
                      "children": []
                    }
                  ]
                }
              ]
            }
          ],
          "totalCategories": 120
        }
      }
    },
    {
      "name": "Listar Categorias Raiz",
      "method": "GET",
      "path": "/root",
      "description": "Retorna apenas as categorias principais (n√≠vel 0)",
      "authentication": "Public",
      "response": {
        "success": true,
        "data": {
          "categories": [
            {
              "id": "uuid",
              "name": "Social",
              "slug": "social",
              "description": "Se√ß√£o dedicada a Social",
              "parent_id": null,
              "display_order": 0,
              "is_locked": false,
              "icon": "üë•",
              "level": 0,
              "thread_count": 0,
              "post_count": 0,
              "last_thread_id": null,
              "last_post_at": null,
              "created_at": "timestamp",
              "updated_at": "timestamp"
            }
          ],
          "count": 6
        }
      }
    },
    {
      "name": "Listar Todas as Categorias (Flat)",
      "method": "GET",
      "path": "/",
      "description": "Retorna todas as categorias em lista plana, ordenadas por n√≠vel e ordem de exibi√ß√£o",
      "authentication": "Public",
      "response": {
        "success": true,
        "data": {
          "categories": [
            {
              "id": "uuid",
              "name": "string",
              "slug": "string",
              "description": "string | null",
              "parent_id": "uuid | null",
              "display_order": "number",
              "is_locked": "boolean",
              "icon": "string | null",
              "level": "number",
              "thread_count": "number",
              "post_count": "number",
              "last_thread_id": "uuid | null",
              "last_post_at": "timestamp | null",
              "created_at": "timestamp",
              "updated_at": "timestamp"
            }
          ],
          "count": 120
        }
      }
    },
    {
      "name": "Buscar Categoria por Slug",
      "method": "GET",
      "path": "/slug/:slug",
      "description": "Busca uma categoria pelo slug e retorna suas subcategorias diretas",
      "authentication": "Public",
      "params": {
        "slug": "string (slug da categoria)"
      },
      "example": "/slug/social",
      "response": {
        "success": true,
        "data": {
          "category": {
            "id": "uuid",
            "name": "Social",
            "slug": "social",
            "description": "Se√ß√£o dedicada a Social",
            "parent_id": null,
            "display_order": 0,
            "is_locked": false,
            "icon": "üë•",
            "level": 0,
            "thread_count": 0,
            "post_count": 0,
            "last_thread_id": null,
            "last_post_at": null,
            "created_at": "timestamp",
            "updated_at": "timestamp"
          },
          "subcategories": [
            {
              "id": "uuid",
              "name": "Not√≠cias",
              "slug": "noticias",
              "parent_id": "uuid",
              "level": 1,
              "thread_count": 5
            }
          ]
        }
      }
    },
    {
      "name": "Buscar Categoria por ID",
      "method": "GET",
      "path": "/:categoryId",
      "description": "Busca uma categoria pelo ID e retorna suas subcategorias diretas",
      "authentication": "Public",
      "params": {
        "categoryId": "UUID da categoria"
      },
      "response": {
        "success": true,
        "data": {
          "category": {
            "id": "uuid",
            "name": "string",
            "slug": "string",
            "description": "string | null",
            "parent_id": "uuid | null",
            "display_order": "number",
            "is_locked": "boolean",
            "icon": "string | null",
            "level": "number",
            "thread_count": "number",
            "post_count": "number"
          },
          "subcategories": []
        }
      }
    },
    {
      "name": "Criar Nova Categoria",
      "method": "POST",
      "path": "/",
      "description": "Cria uma nova categoria ou subcategoria. M√°ximo de 3 n√≠veis de profundidade.",
      "authentication": "Required (Admin+)",
      "headers": {
        "Authorization": "Bearer {token}",
        "Content-Type": "application/json"
      },
      "body": {
        "name": "string (2-100 caracteres, obrigat√≥rio)",
        "slug": "string (2-100 caracteres, apenas min√∫sculas, n√∫meros e h√≠fens, obrigat√≥rio)",
        "description": "string (m√°x 1000 caracteres, opcional)",
        "parentId": "UUID (opcional, null para categoria raiz)",
        "displayOrder": "number (ordem de exibi√ß√£o, opcional, default: 0)",
        "isLocked": "boolean (impede cria√ß√£o de threads, opcional, default: false)",
        "icon": "string (emoji ou c√≥digo, m√°x 50 caracteres, opcional)"
      },
      "example": {
        "name": "Tecnologia",
        "slug": "tecnologia",
        "description": "Discuss√µes sobre tecnologia e inova√ß√£o",
        "parentId": null,
        "displayOrder": 0,
        "isLocked": false,
        "icon": "üíª"
      },
      "validations": {
        "name": "2-100 caracteres",
        "slug": "√önico no sistema, apenas letras min√∫sculas, n√∫meros e h√≠fens",
        "parentId": "Deve existir e n√£o pode criar mais de 2 n√≠veis de profundidade",
        "level": "M√°ximo 2 n√≠veis de subcategorias"
      },
      "response": {
        "success": true,
        "data": {
          "category": {
            "id": "uuid",
            "name": "Tecnologia",
            "slug": "tecnologia",
            "description": "Discuss√µes sobre tecnologia e inova√ß√£o",
            "parent_id": null,
            "display_order": 0,
            "is_locked": false,
            "icon": "üíª",
            "level": 0,
            "thread_count": 0,
            "post_count": 0,
            "created_at": "timestamp",
            "updated_at": "timestamp"
          },
          "message": "Categoria criada com sucesso"
        }
      }
    },
    {
      "name": "Atualizar Categoria",
      "method": "PATCH",
      "path": "/:categoryId",
      "description": "Atualiza informa√ß√µes de uma categoria existente",
      "authentication": "Required (Admin+)",
      "headers": {
        "Authorization": "Bearer {token}",
        "Content-Type": "application/json"
      },
      "params": {
        "categoryId": "UUID da categoria"
      },
      "body": {
        "name": "string (opcional)",
        "slug": "string (opcional)",
        "description": "string (opcional)",
        "displayOrder": "number (opcional)",
        "isLocked": "boolean (opcional)",
        "icon": "string (opcional)"
      },
      "example": {
        "name": "Tecnologia & Inova√ß√£o",
        "description": "Discuss√µes sobre tecnologia, inova√ß√£o e futuro",
        "icon": "üöÄ"
      },
      "validations": {
        "atLeastOneField": "Pelo menos um campo deve ser fornecido",
        "slug": "Se fornecido, deve ser √∫nico"
      },
      "response": {
        "success": true,
        "data": {
          "category": {
            "id": "uuid",
            "name": "Tecnologia & Inova√ß√£o",
            "slug": "tecnologia",
            "description": "Discuss√µes sobre tecnologia, inova√ß√£o e futuro",
            "icon": "üöÄ",
            "updated_at": "timestamp"
          },
          "message": "Categoria atualizada com sucesso"
        }
      }
    },
    {
      "name": "Deletar Categoria",
      "method": "DELETE",
      "path": "/:categoryId",
      "description": "Deleta uma categoria. Falha se houver threads ou subcategorias.",
      "authentication": "Required (Admin+)",
      "headers": {
        "Authorization": "Bearer {token}"
      },
      "params": {
        "categoryId": "UUID da categoria"
      },
      "validations": {
        "noThreads": "Categoria n√£o pode ter threads existentes",
        "noSubcategories": "Categoria n√£o pode ter subcategorias"
      },
      "response": {
        "success": true,
        "data": {
          "message": "Categoria deletada com sucesso"
        }
      },
      "errors": {
        "hasThreads": {
          "success": false,
          "error": {
            "message": "N√£o √© poss√≠vel deletar categoria com 15 thread(s) existente(s)",
            "code": "BAD_REQUEST"
          }
        },
        "hasSubcategories": {
          "success": false,
          "error": {
            "message": "N√£o √© poss√≠vel deletar categoria com subcategorias. Delete as subcategorias primeiro.",
            "code": "BAD_REQUEST"
          }
        }
      }
    },
    {
      "name": "Reordenar Categorias",
      "method": "PUT",
      "path": "/reorder",
      "description": "Atualiza a ordem de exibi√ß√£o de m√∫ltiplas categorias simultaneamente",
      "authentication": "Required (Admin+)",
      "headers": {
        "Authorization": "Bearer {token}",
        "Content-Type": "application/json"
      },
      "body": {
        "categories": [
          {
            "id": "UUID da categoria",
            "displayOrder": "number (nova ordem)"
          }
        ]
      },
      "example": {
        "categories": [
          {
            "id": "uuid-1",
            "displayOrder": 0
          },
          {
            "id": "uuid-2",
            "displayOrder": 1
          },
          {
            "id": "uuid-3",
            "displayOrder": 2
          }
        ]
      },
      "validations": {
        "minCategories": "Deve fornecer pelo menos uma categoria",
        "validIds": "Todos os IDs devem ser UUIDs v√°lidos",
        "positiveOrder": "Ordem deve ser n√∫mero positivo"
      },
      "response": {
        "success": true,
        "data": {
          "message": "Categorias reordenadas com sucesso",
          "updated": 3
        }
      }
    },
    {
      "name": "Bloquear/Desbloquear Categoria",
      "method": "PATCH",
      "path": "/:categoryId/toggle-lock",
      "description": "Alterna o status de bloqueio de uma categoria. Quando bloqueada, novos threads n√£o podem ser criados.",
      "authentication": "Required (Admin+)",
      "headers": {
        "Authorization": "Bearer {token}"
      },
      "params": {
        "categoryId": "UUID da categoria"
      },
      "response": {
        "success": true,
        "data": {
          "category": {
            "id": "uuid",
            "name": "string",
            "is_locked": true,
            "updated_at": "timestamp"
          },
          "message": "Categoria bloqueada. Novos threads n√£o podem ser criados."
        }
      }
    }
  ],
  "errorResponses": {
    "400": {
      "description": "Bad Request - Valida√ß√£o falhou",
      "examples": [
        {
          "success": false,
          "error": {
            "message": "N√£o √© permitido criar subcategorias al√©m do n√≠vel 2",
            "code": "BAD_REQUEST"
          }
        },
        {
          "success": false,
          "error": {
            "message": "N√£o √© poss√≠vel deletar categoria com 15 thread(s) existente(s)",
            "code": "BAD_REQUEST"
          }
        },
        {
          "success": false,
          "error": {
            "message": "Pelo menos um campo deve ser fornecido para atualiza√ß√£o",
            "code": "BAD_REQUEST"
          }
        }
      ]
    },
    "401": {
      "description": "Unauthorized - Token inv√°lido",
      "example": {
        "success": false,
        "error": {
          "message": "Token inv√°lido ou expirado",
          "code": "UNAUTHORIZED"
        }
      }
    },
    "403": {
      "description": "Forbidden - Sem permiss√£o (apenas Admin/Master)",
      "example": {
        "success": false,
        "error": {
          "message": "Acesso restrito. Cargos permitidos: admin, master",
          "code": "FORBIDDEN"
        }
      }
    },
    "404": {
      "description": "Not Found - Categoria n√£o encontrada",
      "example": {
        "success": false,
        "error": {
          "message": "Categoria n√£o encontrada",
          "code": "NOT_FOUND"
        }
      }
    },
    "409": {
      "description": "Conflict - Slug j√° existe",
      "example": {
        "success": false,
        "error": {
          "message": "Slug j√° est√° em uso",
          "code": "CONFLICT"
        }
      }
    }
  },
  "security": {
    "publicRoutes": [
      "GET /tree",
      "GET /root",
      "GET /",
      "GET /slug/:slug",
      "GET /:categoryId"
    ],
    "adminRoutes": [
      "POST /",
      "PATCH /:categoryId",
      "DELETE /:categoryId",
      "PUT /reorder",
      "PATCH /:categoryId/toggle-lock"
    ],
    "authentication": "JWT Bearer Token com verifica√ß√£o de cargo Admin ou Master",
    "validation": "Zod schemas para todos os inputs",
    "sqlProtection": "Triggers SQL impedem exclus√£o de categorias com conte√∫do"
  },
  "database": {
    "tables": [
      "categories (id, name, slug, description, parent_id, display_order, is_locked, icon, level, thread_count, post_count, last_thread_id, last_post_at)"
    ],
    "migrations": [
      "004_categories_system.sql"
    ],
    "functions": [
      "calculate_category_level(category_id) - Calcula n√≠vel da categoria na √°rvore",
      "get_category_tree() - Retorna √°rvore completa de categorias",
      "get_subcategories(parent_id) - Retorna subcategorias de uma categoria",
      "prevent_delete_category_with_threads() - Trigger que impede exclus√£o com threads"
    ],
    "triggers": [
      "validate_category_level - Valida n√≠vel antes de inserir/atualizar",
      "update_category_counters - Atualiza contadores quando threads s√£o criadas/deletadas",
      "prevent_delete_category_with_threads - Impede exclus√£o de categorias com conte√∫do"
    ],
    "constraints": [
      "M√°ximo 2 n√≠veis de subcategorias (0, 1, 2)",
      "Slug √∫nico em todo o sistema",
      "ON DELETE RESTRICT para parent_id (impede deletar categoria com filhos)",
      "Categoria n√£o pode ser pai de si mesma"
    ]
  },
  "features": {
    "hierarchy": "Estrutura em √°rvore com at√© 3 n√≠veis",
    "slugs": "URLs amig√°veis geradas automaticamente",
    "locking": "Bloqueio de categorias para impedir novos threads",
    "counters": "Contadores autom√°ticos de threads e posts",
    "ordering": "Sistema de ordena√ß√£o customiz√°vel",
    "icons": "Suporte a emojis e √≠cones para categorias",
    "validation": "Valida√ß√µes SQL e aplica√ß√£o impedem estruturas inv√°lidas",
    "protection": "Imposs√≠vel deletar categorias com conte√∫do"
  },
  "seedData": {
    "description": "Dados iniciais para popular o f√≥rum",
    "file": "docs/seed.json",
    "script": "scripts/seed-categories.ts",
    "usage": [
      "1. Execute a migra√ß√£o: 004_categories_system.sql",
      "2. Execute o script de seed: npx ts-node scripts/seed-categories.ts",
      "3. Verifique as categorias criadas via GET /categories/tree"
    ],
    "categories": [
      "Social (Not√≠cias, Novidades, Cargos Abertos, Apresenta√ß√µes)",
      "GTracker (Filmes, S√©ries, Jogos, Softwares)",
      "Comunidade (Filmes, S√©ries, Jogos, Criadores de Conte√∫do)",
      "Suporte (Suporte T√©cnico, Tutoriais, Sugest√µes)",
      "Entretenimento (M√∫sicas, Animes & Mang√°s, Livros & HQs)",
      "Off-Topic (Conversas Gerais, Tecnologia, Humor, Marketplace)"
    ]
  },
  "bestPractices": [
    "Use slugs descritivos e √∫nicos",
    "Organize conte√∫do em no m√°ximo 3 n√≠veis",
    "Bloqueie categorias temporariamente durante manuten√ß√£o",
    "Delete threads antes de deletar categorias",
    "Use √≠cones para facilitar navega√ß√£o visual",
    "Mantenha ordem l√≥gica nas categorias principais",
    "Agrupe conte√∫do relacionado em subcategorias",
    "Evite criar muitas categorias raiz (m√°ximo 6-8 recomendado)"
  ],
  "exampleFlows": {
    "createCategory": [
      "1. Admin autentica com JWT",
      "2. POST /categories com name, slug, description",
      "3. Sistema valida slug √∫nico e n√≠vel m√°ximo",
      "4. Categoria criada com level calculado automaticamente",
      "5. Retorna categoria completa com ID"
    ],
    "createSubcategory": [
      "1. POST /categories com parentId definido",
      "2. Sistema verifica se categoria pai existe",
      "3. Sistema valida que n√£o excede n√≠vel 2",
      "4. Subcategoria criada com level = parent.level + 1",
      "5. Aparece na √°rvore sob a categoria pai"
    ],
    "deleteCategory": [
      "1. DELETE /categories/:id",
      "2. Sistema verifica se tem subcategorias",
      "3. Sistema verifica se tem threads (via trigger SQL)",
      "4. Se tudo OK, categoria deletada",
      "5. Se tiver conte√∫do, retorna erro 400"
    ],
    "viewTree": [
      "1. Frontend faz GET /categories/tree",
      "2. Sistema executa fun√ß√£o SQL get_category_tree()",
      "3. Retorna estrutura hier√°rquica completa",
      "4. Frontend renderiza √°rvore naveg√°vel",
      "5. Usu√°rio clica e navega pelas categorias"
    ]
  },
  "notes": [
    "Categorias bloqueadas (is_locked=true) impedem cria√ß√£o de novos threads",
    "Contadores (thread_count, post_count) s√£o atualizados automaticamente via triggers",
    "Slugs devem ser √∫nicos em todo o sistema, n√£o apenas por n√≠vel",
    "Sistema usa adjacency list para hierarquia (parent_id)",
    "Fun√ß√£o SQL get_category_tree() constr√≥i √°rvore recursivamente",
    "M√°ximo de 2 n√≠veis de subcategorias √© validado em SQL e aplica√ß√£o",
    "√çcones s√£o opcionais e suportam emojis Unicode",
    "Ordem de exibi√ß√£o pode ser customizada via display_order"
  ]
}
